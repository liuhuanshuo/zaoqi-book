#!/usr/bin/env python
# coding: utf-8

# # è¯»å– Excel æ–‡ä»¶

# ```{admonition} åœ¨çº¿åˆ·é¢˜
# :class: seealso
# 
# æ£€æŸ¥ or å¼ºåŒ– `Pandas` æ•°æ®åˆ†ææ“ä½œï¼Ÿ<a href="https://www.heywhale.com/mw/project/6146c0318447b8001769ff20" target="_blank">ğŸ‘‰åœ¨çº¿ä½“éªŒã€ŒPandasè¿›é˜¶ä¿®ç‚¼300é¢˜ã€</a>
# ```

# ```{note} 
# æœ¬é¡µé¢ä»£ç å¯ä»¥[åœ¨çº¿ç¼–è¾‘ã€æ‰§è¡Œ](../æŒ‡å¼•/åœ¨çº¿æ‰§è¡Œ.md)ï¼
# ```

# ## é»˜è®¤è¯»å–
# 
# 
# é»˜è®¤è¯»å–æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œä½¿ç”¨ `pd.read_csv('xxxx.csv')` å³å¯è¯»å–å¯¹åº”æ–‡ä»¶
# 
# ç°åœ¨å°è¯•ä½¿ç”¨ `pandas` è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv`
# 

# In[1]:


import pandas as pd
data = pd.read_csv("æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv")


# ```{admonition} æ³¨æ„
# :class: Attention
# 
# ä½¿ç”¨ `pandas` è¯»å– `CSV` ä¸è¯»å– `xlsx` æ ¼å¼çš„ `Excel` æ–‡ä»¶æ–¹æ³•å¤§è‡´ç›¸åŒ
# 
# å› æ­¤ä¸‹é¢ä¸ `Excel` ç›¸å…³çš„è¯»å–æ“ä½œå‡ä»¥ `CSV` æ ¼å¼è¿›è¡Œä»‹ç»
# 
# ```

# ## è¯»å–å‰ n è¡Œ
# 
# 
# è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶çš„ **å‰20è¡Œ**

# In[2]:


data = pd.read_csv("æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv",nrows = 20)


# ## è·³è¿‡å‰ n è¡Œ
# 
# è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶å¹¶ **è·³è¿‡å‰20è¡Œ**

# In[3]:


data = pd.read_csv("æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv",skiprows = [i for i in range(1,21)])


# ## æŒ‡å®šè¡Œè¯»å–
# 
# è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶ä¸­å…¨éƒ¨**å¶æ•°è¡Œ**

# In[4]:


data = pd.read_csv('æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv', skiprows=lambda x: (x != 0) and not x % 2)


# ```{admonition} æ€è€ƒ
# :class: hint
# 
# å¦‚æœæ˜¯è¯»å–å…¨éƒ¨å¥‡æ•°è¡Œï¼Œæˆ–è€…æ›´å¤šæ»¡è¶³æŒ‡å®šæ¡ä»¶çš„è¡Œå‘¢ï¼Ÿ
# ```

# In[5]:


data = pd.read_csv('æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv', skiprows=lambda x: x % 2) #è¯»å–å¥‡æ•°è¡Œ


# ## æŒ‡å®šåˆ—å·è¯»å–
# 
# 
# è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶çš„ç¬¬ `1ã€3ã€5` åˆ—

# In[6]:


data = pd.read_csv("æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv",usecols = [0,2,4])


# ##  æŒ‡å®šåˆ—åè¯»å–
# 
# 
# è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶çš„ `positionIdã€positionNameã€salary` åˆ—

# In[7]:


data = pd.read_csv("æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv",usecols = ['positionId','positionName','salary'])


# ## æŒ‡å®šåˆ—åŒ¹é…è¯»å–
# 
# 
# è®©æˆ‘ä»¬æ¥ä¸ªæ›´éš¾ä¸€ç‚¹çš„ï¼Œè¿˜æ˜¯è¯»å– `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶ï¼Œä½†ç°åœ¨æœ‰ä¸€ä¸ª list ä¸­åŒ…å«å¤šä¸ªå­—æ®µğŸ‘‡
# 
# `usecols = ['positionId','test','positionName', 'test1','salary']`
# 
# å¦‚æœ `usecols` ä¸­çš„åˆ—åå­˜åœ¨äº `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` ä¸­ï¼Œåˆ™è¯»å–ã€‚

# In[8]:


usecols = ['positionId', 'test', 'positionName', 'test1', 'salary']

data = pd.read_csv('æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv', usecols=lambda c: c in set(usecols))


# ## è¯»å–æ—¶è®¾ç½®ç´¢å¼•
# 
# 
# è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶ï¼Œå¹¶åœ¨è¯»å–æ—¶å°† `positionId` è®¾ç½®ä¸ºç´¢å¼•åˆ—

# In[9]:


data = pd.read_csv('æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv',index_col=['positionId'])


# ## è¯»å–æ—¶è®¾ç½®æ ‡é¢˜
# 
# <br>
# 
# 
# è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶çš„ `positionIdã€positionNameã€salary` åˆ—ï¼Œå¹¶å°†æ ‡é¢˜è®¾ç½®ä¸º `IDã€å²—ä½åç§°ã€è–ªèµ„`

# In[10]:


data = pd.read_csv('æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv', usecols=[0,1,17],header = 0,names=['ID','å²—ä½åç§°','è–ªèµ„'])


# ## è¯»å–å¹¶å¤„ç†ç¼ºå¤±å€¼
# 
# 
# 
# 
# - è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶ï¼Œ**å¹¶ä¸å°†ç¼ºå¤±å€¼æ ‡è®°ä¸º `NA`**
# - è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶ï¼Œ**å¹¶å°†`[]`æ ‡è®°ä¸ºç¼ºå¤±å€¼**
# - è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶ï¼Œ**ä½†ä¸å¤„ç†ç¼ºå¤±å€¼**

# In[11]:


data = pd.read_csv('æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv', keep_default_na=False)

data = pd.read_csv('æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv',na_values=['[]'])

data = pd.read_csv("æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv",na_filter=False)


# ```{admonition} æ€è€ƒ
# :class: hint
# 
# è¿™ä¸‰ç§æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
# ```

# ## è¯»å–æ—¶è®¾ç½®æ ¼å¼
# 
# 
# - è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶ï¼Œå¹¶å°† `positionId,companyId` è®¾ç½®ä¸ºå­—ç¬¦ä¸²æ ¼å¼
# 
# - è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶ï¼Œå¹¶å°† `createTime` åˆ—è®¾ç½®ä¸ºæ—¶é—´

# In[12]:


data = pd.read_csv("æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv", dtype={'positionId': str,'companyId':str}) #æŒ‡å®šå­—ç¬¦ä¸²æ ¼å¼

data = pd.read_csv("æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv",parse_dates=['createTime']) #æŒ‡å®šæ—¶é—´æ ¼å¼


# ## åˆ†å—è¯»å–
# 
# 
# è¯»å–å½“å‰ç›®å½•ä¸‹ `æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv` æ–‡ä»¶ï¼Œè¦æ±‚è¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œæ¯æ¬¡è¯»å– 10 è¡Œ

# In[13]:


data = pd.read_csv("æŸæ‹›è˜ç½‘ç«™æ•°æ®.csv", chunksize= 10)


# ```{admonition} æ€è€ƒ
# :class: hint
# 
# ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ
# ```

# ## å¾ªç¯è¯»å–æ•°æ®
# 
# 
# åœ¨ `demodata` æ–‡ä»¶å¤¹ä¸‹æœ‰å¤šä¸ª `Excel` æ–‡ä»¶ï¼Œè¦æ±‚ä¸€æ¬¡æ€§å¾ªç¯è¯»å–å…¨éƒ¨æ–‡ä»¶

# In[14]:


import os
path = 'demodata/'
filesnames = os.listdir(path)
filesnames = [f for f in filesnames if f.lower().endswith(".xlsx")]
df_list = []
for filename in filesnames:
    df_list.append(pd.read_excel(path + filename))

df = pd.concat(df_list)

